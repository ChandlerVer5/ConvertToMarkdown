{"version":3,"sources":["webpack/bootstrap 8e93802affa555e76a66","/Users/liang/Projects/@gxl/epub-parser/src/link.ts","/Users/liang/Projects/@gxl/epub-parser/~/charenc/charenc.js","/Users/liang/Projects/@gxl/epub-parser/~/md5/md5.js","external \"babel-runtime/core-js/object/assign\"","external \"babel-runtime/helpers/classCallCheck\"","external \"babel-runtime/helpers/createClass\"","external \"debug\"","./epubParser.ts","/Users/liang/Projects/@gxl/epub-parser/src/epub-parser.ts","/Users/liang/Projects/@gxl/epub-parser/src/parseHTML.ts","/Users/liang/Projects/@gxl/epub-parser/src/parseSection.ts","/Users/liang/Projects/@gxl/epub-parser/src/utils.ts","external \"babel-runtime/core-js/promise\"","external \"babel-runtime/helpers/defineProperty\"","external \"babel-runtime/helpers/typeof\"","external \"babel-runtime/regenerator\"","external \"crypt\"","external \"fs\"","external \"is-buffer\"","external \"jsdom\"","external \"lodash/find\"","external \"lodash/flattenDeep\"","external \"lodash/forEach\"","external \"lodash/get\"","external \"lodash/isArrayLike\"","external \"lodash/isArrayLikeObject\"","external \"lodash/isEmpty\"","external \"lodash/last\"","external \"lodash/map\"","external \"lodash/omit\"","external \"lodash/union\"","external \"node-zip\"","external \"path\"","external \"xml2js\""],"names":[],"mappings":";;;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;mBC9DsC;AACpC,QAAU,OAAO,KAAM,MAAK,KAAG;AAC/B,QAAS,MAAO,KAAM,MAAK,KAAG;AAC9B,QAAY,SAAM,IAAM,MAAK,KAAM,MAAE,GAAE,CAAG,GAAK,KAAK;AACpD,QAAc,WAAS,oBAAI,IAAM,MAAgB;AACjD,QAAU,OAAW,SAAM,MAAK,KAAM,MAAE,GAAE,CAAG,GAAK,KAAK;AACvD,QAAO,MAAS,oBAAS,SAAM,MAAM;AAElC,QAAS,SAAQ,QAAK,SAAK,CAAG,GAAE;AAC9B,cACL;AAAC;AAEK,WAAC,EAAM,YAAM,YAAK,UAAQ,gBAClC;AAAC,C;;;;;;ACfD;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,iCAAiC,gBAAgB;AACjD;AACA;AACA,KAAK;;AAEL;AACA;AACA,+BAA+B,kBAAkB;AACjD;AACA;AACA;AACA;AACA;;AAEA;;;;;;;AChCA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,cAAc;AACjC;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,cAAc;;AAEjC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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","file":"epubParser.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 34);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 8e93802affa555e76a66","import _ from 'lodash'\n\nexport default function parseLink(href) {\n  const hash = href.split('#')[1]\n  const url = href.split('#')[0]\n  const prefix = url.split('/').slice(0, -1).join('/')\n  const filename = _.last(url.split('/')) as string\n  const name = filename.split('.').slice(0, -1).join('.')\n  let ext = _.last(filename.split('.'))\n\n  if (filename.indexOf('.') === -1) {\n    ext = ''\n  }\n\n  return { hash, name, ext, prefix, url }\n}\n\n\n\n// WEBPACK FOOTER //\n// /Users/liang/Projects/@gxl/epub-parser/src/link.ts","var charenc = {\n  // UTF-8 encoding\n  utf8: {\n    // Convert a string to a byte array\n    stringToBytes: function(str) {\n      return charenc.bin.stringToBytes(unescape(encodeURIComponent(str)));\n    },\n\n    // Convert a byte array to a string\n    bytesToString: function(bytes) {\n      return decodeURIComponent(escape(charenc.bin.bytesToString(bytes)));\n    }\n  },\n\n  // Binary encoding\n  bin: {\n    // Convert a string to a byte array\n    stringToBytes: function(str) {\n      for (var bytes = [], i = 0; i < str.length; i++)\n        bytes.push(str.charCodeAt(i) & 0xFF);\n      return bytes;\n    },\n\n    // Convert a byte array to a string\n    bytesToString: function(bytes) {\n      for (var str = [], i = 0; i < bytes.length; i++)\n        str.push(String.fromCharCode(bytes[i]));\n      return str.join('');\n    }\n  }\n};\n\nmodule.exports = charenc;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// /Users/liang/Projects/@gxl/epub-parser/~/charenc/charenc.js\n// module id = 1\n// module chunks = 0","(function(){\r\n  var crypt = require('crypt'),\r\n      utf8 = require('charenc').utf8,\r\n      isBuffer = require('is-buffer'),\r\n      bin = require('charenc').bin,\r\n\r\n  // The core\r\n  md5 = function (message, options) {\r\n    // Convert to byte array\r\n    if (message.constructor == String)\r\n      if (options && options.encoding === 'binary')\r\n        message = bin.stringToBytes(message);\r\n      else\r\n        message = utf8.stringToBytes(message);\r\n    else if (isBuffer(message))\r\n      message = Array.prototype.slice.call(message, 0);\r\n    else if (!Array.isArray(message))\r\n      message = message.toString();\r\n    // else, assume byte array already\r\n\r\n    var m = crypt.bytesToWords(message),\r\n        l = message.length * 8,\r\n        a =  1732584193,\r\n        b = -271733879,\r\n        c = -1732584194,\r\n        d =  271733878;\r\n\r\n    // Swap endian\r\n    for (var i = 0; i < m.length; i++) {\r\n      m[i] = ((m[i] <<  8) | (m[i] >>> 24)) & 0x00FF00FF |\r\n             ((m[i] << 24) | (m[i] >>>  8)) & 0xFF00FF00;\r\n    }\r\n\r\n    // Padding\r\n    m[l >>> 5] |= 0x80 << (l % 32);\r\n    m[(((l + 64) >>> 9) << 4) + 14] = l;\r\n\r\n    // Method shortcuts\r\n    var FF = md5._ff,\r\n        GG = md5._gg,\r\n        HH = md5._hh,\r\n        II = md5._ii;\r\n\r\n    for (var i = 0; i < m.length; i += 16) {\r\n\r\n      var aa = a,\r\n          bb = b,\r\n          cc = c,\r\n          dd = d;\r\n\r\n      a = FF(a, b, c, d, m[i+ 0],  7, -680876936);\r\n      d = FF(d, a, b, c, m[i+ 1], 12, -389564586);\r\n      c = FF(c, d, a, b, m[i+ 2], 17,  606105819);\r\n      b = FF(b, c, d, a, m[i+ 3], 22, -1044525330);\r\n      a = FF(a, b, c, d, m[i+ 4],  7, -176418897);\r\n      d = FF(d, a, b, c, m[i+ 5], 12,  1200080426);\r\n      c = FF(c, d, a, b, m[i+ 6], 17, -1473231341);\r\n      b = FF(b, c, d, a, m[i+ 7], 22, -45705983);\r\n      a = FF(a, b, c, d, m[i+ 8],  7,  1770035416);\r\n      d = FF(d, a, b, c, m[i+ 9], 12, -1958414417);\r\n      c = FF(c, d, a, b, m[i+10], 17, -42063);\r\n      b = FF(b, c, d, a, m[i+11], 22, -1990404162);\r\n      a = FF(a, b, c, d, m[i+12],  7,  1804603682);\r\n      d = FF(d, a, b, c, m[i+13], 12, -40341101);\r\n      c = FF(c, d, a, b, m[i+14], 17, -1502002290);\r\n      b = FF(b, c, d, a, m[i+15], 22,  1236535329);\r\n\r\n      a = GG(a, b, c, d, m[i+ 1],  5, -165796510);\r\n      d = GG(d, a, b, c, m[i+ 6],  9, -1069501632);\r\n      c = GG(c, d, a, b, m[i+11], 14,  643717713);\r\n      b = GG(b, c, d, a, m[i+ 0], 20, -373897302);\r\n      a = GG(a, b, c, d, m[i+ 5],  5, -701558691);\r\n      d = GG(d, a, b, c, m[i+10],  9,  38016083);\r\n      c = GG(c, d, a, b, m[i+15], 14, -660478335);\r\n      b = GG(b, c, d, a, m[i+ 4], 20, -405537848);\r\n      a = GG(a, b, c, d, m[i+ 9],  5,  568446438);\r\n      d = GG(d, a, b, c, m[i+14],  9, -1019803690);\r\n      c = GG(c, d, a, b, m[i+ 3], 14, -187363961);\r\n      b = GG(b, c, d, a, m[i+ 8], 20,  1163531501);\r\n      a = GG(a, b, c, d, m[i+13],  5, -1444681467);\r\n      d = GG(d, a, b, c, m[i+ 2],  9, -51403784);\r\n      c = GG(c, d, a, b, m[i+ 7], 14,  1735328473);\r\n      b = GG(b, c, d, a, m[i+12], 20, -1926607734);\r\n\r\n      a = HH(a, b, c, d, m[i+ 5],  4, -378558);\r\n      d = HH(d, a, b, c, m[i+ 8], 11, -2022574463);\r\n      c = HH(c, d, a, b, m[i+11], 16,  1839030562);\r\n      b = HH(b, c, d, a, m[i+14], 23, -35309556);\r\n      a = HH(a, b, c, d, m[i+ 1],  4, -1530992060);\r\n      d = HH(d, a, b, c, m[i+ 4], 11,  1272893353);\r\n      c = HH(c, d, a, b, m[i+ 7], 16, -155497632);\r\n      b = HH(b, c, d, a, m[i+10], 23, -1094730640);\r\n      a = HH(a, b, c, d, m[i+13],  4,  681279174);\r\n      d = HH(d, a, b, c, m[i+ 0], 11, -358537222);\r\n      c = HH(c, d, a, b, m[i+ 3], 16, -722521979);\r\n      b = HH(b, c, d, a, m[i+ 6], 23,  76029189);\r\n      a = HH(a, b, c, d, m[i+ 9],  4, -640364487);\r\n      d = HH(d, a, b, c, m[i+12], 11, -421815835);\r\n      c = HH(c, d, a, b, m[i+15], 16,  530742520);\r\n      b = HH(b, c, d, a, m[i+ 2], 23, -995338651);\r\n\r\n      a = II(a, b, c, d, m[i+ 0],  6, -198630844);\r\n      d = II(d, a, b, c, m[i+ 7], 10,  1126891415);\r\n      c = II(c, d, a, b, m[i+14], 15, -1416354905);\r\n      b = II(b, c, d, a, m[i+ 5], 21, -57434055);\r\n      a = II(a, b, c, d, m[i+12],  6,  1700485571);\r\n      d = II(d, a, b, c, m[i+ 3], 10, -1894986606);\r\n      c = II(c, d, a, b, m[i+10], 15, -1051523);\r\n      b = II(b, c, d, a, m[i+ 1], 21, -2054922799);\r\n      a = II(a, b, c, d, m[i+ 8],  6,  1873313359);\r\n      d = II(d, a, b, c, m[i+15], 10, -30611744);\r\n      c = II(c, d, a, b, m[i+ 6], 15, -1560198380);\r\n      b = II(b, c, d, a, m[i+13], 21,  1309151649);\r\n      a = II(a, b, c, d, m[i+ 4],  6, -145523070);\r\n      d = II(d, a, b, c, m[i+11], 10, -1120210379);\r\n      c = II(c, d, a, b, m[i+ 2], 15,  718787259);\r\n      b = II(b, c, d, a, m[i+ 9], 21, -343485551);\r\n\r\n      a = (a + aa) >>> 0;\r\n      b = (b + bb) >>> 0;\r\n      c = (c + cc) >>> 0;\r\n      d = (d + dd) >>> 0;\r\n    }\r\n\r\n    return crypt.endian([a, b, c, d]);\r\n  };\r\n\r\n  // Auxiliary functions\r\n  md5._ff  = function (a, b, c, d, x, s, t) {\r\n    var n = a + (b & c | ~b & d) + (x >>> 0) + t;\r\n    return ((n << s) | (n >>> (32 - s))) + b;\r\n  };\r\n  md5._gg  = function (a, b, c, d, x, s, t) {\r\n    var n = a + (b & d | c & ~d) + (x >>> 0) + t;\r\n    return ((n << s) | (n >>> (32 - s))) + b;\r\n  };\r\n  md5._hh  = function (a, b, c, d, x, s, t) {\r\n    var n = a + (b ^ c ^ d) + (x >>> 0) + t;\r\n    return ((n << s) | (n >>> (32 - s))) + b;\r\n  };\r\n  md5._ii  = function (a, b, c, d, x, s, t) {\r\n    var n = a + (c ^ (b | ~d)) + (x >>> 0) + t;\r\n    return ((n << s) | (n >>> (32 - s))) + b;\r\n  };\r\n\r\n  // Package private blocksize\r\n  md5._blocksize = 16;\r\n  md5._digestsize = 16;\r\n\r\n  module.exports = function (message, options) {\r\n    if (message === undefined || message === null)\r\n      throw new Error('Illegal argument ' + message);\r\n\r\n    var digestbytes = crypt.wordsToBytes(md5(message, options));\r\n    return options && options.asBytes ? digestbytes :\r\n        options && options.asString ? bin.bytesToString(digestbytes) :\r\n        crypt.bytesToHex(digestbytes);\r\n  };\r\n\r\n})();\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// /Users/liang/Projects/@gxl/epub-parser/~/md5/md5.js\n// module id = 2\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/object/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/assign\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/classCallCheck\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/classCallCheck\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/createClass\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/createClass\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"debug\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"debug\"\n// module id = 6\n// module chunks = 0","import epubParser from '../../src/epub-parser'\n\nexport default epubParser\n\n\n\n// WEBPACK FOOTER //\n// ./epubParser.ts","import fs from 'fs'\nimport xml2js from 'xml2js'\nimport _ from 'lodash'\nimport nodeZip from 'node-zip'\nimport md5 from 'md5'\nimport parseLink from './link'\nimport parseSection, { Section } from './parseSection'\n\nconst xmlParser = new xml2js.Parser()\n\nconst xmlToJs = (xml) => {\n  return new Promise<any>((resolve, reject) => {\n    xmlParser.parseString(xml, (err, object) => {\n      if (err) {\n        reject(err)\n      } else {\n        resolve(object)\n      }\n    })\n  })\n}\n\nconst determineRoot = (opfPath) => {\n  let root = ''\n  // set the opsRoot for resolving paths\n  if (opfPath.match(/\\//)) { // not at top level\n    root = opfPath.replace(/\\/([^\\/]+)\\.opf/i, '')\n    if (!root.match(/\\/$/)) { // 以 '/' 结尾，下面的 zip 路径写法会简单很多\n      root += '/'\n    }\n    if (root.match(/^\\//)) {\n      root = root.replace(/^\\//, '')\n    }\n  }\n  return root\n}\n\nconst parseMetadata = metadata => {\n  const title = _.get(metadata[0], ['dc:title', 0])\n  let author = _.get(metadata[0], ['dc:creator', 0])\n\n  if (typeof author === 'object') {\n    author = _.get(author, ['_'])\n  }\n\n  const publisher = _.get(metadata[0], ['dc:publisher', 0])\n  const meta = {\n    title,\n    author,\n    publisher\n  }\n  return meta\n}\n\nexport class Epub {\n  private _zip: any // nodeZip instance\n  // private _opfPath: string\n  private _root: string\n  private _content: GeneralObject\n  private manifest: any[]\n  private _spine: string[] // array of ids defined in manifest\n  private _toc: GeneralObject\n  private _metadata: GeneralObject\n  structure: GeneralObject\n  metadata: GeneralObject\n  // sections: {\n  //   id: string\n  //   html: string\n  //   path: string\n  //   // todo: parseLink type\n  //   pathObject: GeneralObject\n  // }[]\n  sections: Section[]\n\n  constructor(buffer) {\n    this._zip = new nodeZip(buffer, { binary: true, base64: false, checkCRC32: true })\n  }\n\n  resolve(path: string): {\n    asText: () => string\n  } {\n    let _path\n    if (path[0] === '/') {\n      // use absolute path, root is zip root\n      _path = path.substr(1)\n    } else {\n      _path = this._root + path\n    }\n    const file = this._zip.file(_path)\n    if (file) {\n      return file\n    } else {\n      throw new Error(`${path} not found!`)\n    }\n  }\n\n  async _resolveXMLAsJsObject(path) {\n    const xml = this.resolve(path).asText()\n    return xmlToJs(xml)\n  }\n\n  private async _getOpfPath() {\n    const container = await this._resolveXMLAsJsObject('/META-INF/container.xml')\n    const opfPath = container.container.rootfiles[0].rootfile[0]['$']['full-path']\n    return opfPath\n  }\n\n  _genStructure(tocObj) {\n    const rootNavPoints = _.get(tocObj, ['ncx', 'navMap', '0', 'navPoint'], [])\n\n    const parseNavPoint = (navPoint) => {\n      // link to section\n      const link = _.get(navPoint, ['content', '0', '$', 'src'], '')\n      // const name = _.get(navPoint, ['navLabel', '0', 'text', '0'])\n      const playOrder = _.get(navPoint, ['$', 'playOrder']) as string\n      // const parsedSrc = parseLink(src)\n      let children = navPoint.navPoint\n\n      if (children) {\n        // tslint:disable-next-line:no-use-before-declare\n        children = parseNavPoints(children)\n      }\n\n      const sectionId = this._resolveIdFromLink(link)\n\n      return {\n        sectionId,\n        // srcObject: parsedSrc,\n        // name,\n        playOrder,\n        children\n      }\n    }\n\n    const parseNavPoints = (navPoints) => {\n      return navPoints.map(point => {\n        return parseNavPoint(point)\n      })\n    }\n\n    return parseNavPoints(rootNavPoints)\n  }\n\n  _getManifest() {\n    return _.get(this._content, ['package', 'manifest', 0, 'item'], [])\n      .map(item => item.$) as any[]\n  }\n\n  _resolveIdFromLink(href) {\n    const { name: tarName } = parseLink(href)\n    const tarItem = _.find(this.manifest, item => {\n      const { name } = parseLink(item.href)\n      return name === tarName\n    })\n    const id = _.get(tarItem, 'id', '')\n    if (id) {\n      return md5(id)\n    }\n    return null\n  }\n\n  _getSpine() {\n    return _.get(this._content, ['package', 'spine', 0, 'itemref'], [])\n      .map(item => {\n        return item.$.idref\n      })\n  }\n\n  _resolveSectionsFromSpine() {\n    // no chain\n    return _.map(_.union(this._spine), id => {\n      const path = _.find(this.manifest, { id }).href\n      // const pathObject = parseLink(path)\n      const html = this.resolve(path).asText()\n      return parseSection({\n        id,\n        htmlString: html,\n        resourceResolver: this.resolve.bind(this),\n        idResolver: this._resolveIdFromLink.bind(this)\n      })\n    })\n  }\n\n  async parse() {\n    const opfPath = await this._getOpfPath()\n    this._root = determineRoot(opfPath)\n    this._content = await this._resolveXMLAsJsObject(opfPath)\n    this.manifest = this._getManifest()\n    this._spine = this._getSpine()\n    const tocID = _.get(this._content, ['package', 'spine', 0, '$', 'toc']) as string\n    const tocPath = _.find(this.manifest, { id: tocID }).href\n    this._toc = await this._resolveXMLAsJsObject(tocPath)\n    this.structure = this._genStructure(this._toc)\n    this._metadata = _.get(this._content, ['package', 'metadata'], [])\n    this.metadata = parseMetadata(this._metadata)\n    this.sections = this._resolveSectionsFromSpine()\n\n    // remove private member vars\n    const isPrivateProp = key => {\n      if (key.length > 1) {\n        if (key[0] === '_' && key[1] !== '_') {\n          return true\n        }\n        return false\n      }\n      return false\n    }\n\n    _.forEach(this, (val, key) => {\n      if (isPrivateProp(key)) {\n        delete this[key]\n      }\n    })\n\n    return this\n  }\n}\n\nexport interface ParserOptions {\n  type?: 'binaryString' | 'path' | 'buffer'\n}\nexport default function parserWrapper(target: string | Buffer, options: ParserOptions = {}) {\n  // seems 260 is the length limit of old windows standard\n  // so path length is not used to determine whether it's path or binary string\n  // the downside here is that if the filepath is incorrect, it will be treated as binary string by default\n  // but it can use options to define the target type\n  let _target = target\n  if (options.type === 'path' || (typeof target === 'string' && fs.existsSync(target))) {\n    _target = fs.readFileSync(target as string, 'binary')\n  }\n  return new Epub(_target).parse()\n}\n\n\n\n// WEBPACK FOOTER //\n// /Users/liang/Projects/@gxl/epub-parser/src/epub-parser.ts","import jsdom from 'jsdom'\nimport _ from 'lodash'\nimport { parseNestedObject } from './utils'\n\nconst debug = require('debug')('readr:html')\n\nconst OMITTED_TAGS = ['head', 'input', 'textarea', 'script', 'style', 'svg']\nconst UNWRAP_TAGS = ['body', 'html', 'div', 'span']\nconst PICKED_ATTRS = ['href', 'src', 'id']\n\n/**\n * recursivelyReadParent\n * @param node \n * @param callback runs the matching logic return the new node if true, if not return false, and the loop continues\n * @param final callback when reaching the root\n */\nconst recursivelyReadParent = (node, callback, final?) => {\n  const _read = (_node) => {\n    const parent = _node.parentNode\n    if (parent) {\n      const newNode = callback(parent)\n      if (!newNode) {\n        return _read(parent)\n      }\n      return newNode\n    } else {\n      if (final) {\n        return final()\n      }\n      return node\n    }\n  }\n  return _read(node)\n}\n\nconst parseRawHTML = HTMLString => {\n  return jsdom\n    .jsdom(HTMLString, {\n      features: {\n        FetchExternalResources: [],\n        ProcessExternalResources: false\n      }\n    })\n    .documentElement\n}\n\nexport interface ParseHTMLObjectConfig {\n  resolveSrc?: (src: string) => string\n  resolveHref?: (href: string) => string\n}\nconst parseHTMLObject = (HTMLString, config: ParseHTMLObjectConfig = {}) => {\n  debug('parseHTMLObject')\n  const rootNode = parseRawHTML(HTMLString)\n  const { resolveHref, resolveSrc } = config\n\n  // initial parse\n  const parsed = parseNestedObject(rootNode, {\n    childrenKey: 'childNodes',\n    preFilter(node) {\n      return node.nodeType === 1 || node.nodeType === 3\n    },\n    parser(node, children) {\n      if (node.nodeType === 1) {\n        const tag = node.tagName.toLowerCase()\n        const attrs: GeneralObject = {}\n\n        if (OMITTED_TAGS.indexOf(tag) !== -1) {\n          return null\n        }\n\n        if (UNWRAP_TAGS.indexOf(tag) !== -1) {\n          const flatten = _.flattenDeep(children)\n          return flatten.length === 1 ? flatten[0] : flatten\n        }\n\n        const flatChildren = _.flattenDeep(children)\n        // todo: join text\n        // const childrenAllString = flatChildren.every(child => typeof child === 'string')\n        // const joinedString = flatChildren.join(' ')\n\n        // if (childrenAllString) {\n        //   return {\n        //     tag,\n        //     children: joinedString ? [joinedString] : undefined\n        //   }\n        // }\n\n        PICKED_ATTRS.forEach(attr => {\n          let attrVal = node.getAttribute(attr) || undefined\n          if (attrVal && attr === 'href' && resolveHref) {\n            attrVal = resolveHref(attrVal)\n          }\n          if (attrVal && attr === 'src' && resolveSrc) {\n            attrVal = resolveSrc(attrVal)\n          }\n          attrs[attr] = attrVal\n        })\n\n        return { tag, type: 1, children: flatChildren, attrs }\n      } else {\n        const text = node.textContent.trim()\n        if (!text) {\n          return null\n        }\n\n        const makeTextObject = () => {\n          return {\n            parentTag: node.parentNode.tagName && node.parentNode.tagName.toLowerCase(),\n            type: 3,\n            text\n          }\n        }\n\n        // find the cloest parent which is not in UNWRAP_TAGS\n        // if failed then wrap with p tag\n        return recursivelyReadParent(node, parent => {\n          const tag = parent.tagName && parent.tagName.toLowerCase()\n          if (!tag || (UNWRAP_TAGS.indexOf(tag) !== -1)) {\n            return false\n          }\n          return makeTextObject()\n        }, () => {\n          return {\n            tag: 'p',\n            children: [makeTextObject()]\n          }\n        })\n      }\n    },\n    postFilter(node) {\n      return !_.isEmpty(node)\n    }\n  }) as ParsedNode[]\n\n  // post parse\n  return parseNestedObject(parsed[0], {\n    childrenKey: 'children',\n    parser(object, children) {\n      if (object.children) {\n        return {\n          ...object,\n          ...{\n            children: !_.isEmpty(children) ? children : undefined\n          }\n        }\n      }\n      return object\n    }\n  })\n}\n\nexport default parseHTMLObject\n\n\n\n// WEBPACK FOOTER //\n// /Users/liang/Projects/@gxl/epub-parser/src/parseHTML.ts","import path from 'path'\nimport parseHTML from './parseHTML'\nimport parseLink from './link'\nimport md5 from 'md5'\n\nconst isInternalUri = (uri) => {\n  return uri.indexOf('http://') === -1 && uri.indexOf('https://') === -1\n}\n\nexport type ParseSectionConfig = {\n  id: string\n  htmlString: string\n  resourceResolver: (path: string) => any\n  idResolver: (link: string) => string\n}\n\nexport class Section {\n  id: string\n  htmlString: string\n  private _resourceResolver: (path: string) => any\n  private _idResolver: (link: string) => string\n\n  constructor({ id, htmlString, resourceResolver, idResolver }: ParseSectionConfig) {\n    this.id = md5(id)\n    this.htmlString = htmlString\n    this._resourceResolver = resourceResolver\n    this._idResolver = idResolver\n  }\n\n  toHtmlObject() {\n    return parseHTML(this.htmlString, {\n      resolveHref: (href) => {\n        if (isInternalUri(href)) {\n          const { hash } = parseLink(href)\n          // todo: what if a link only contains hash part?\n          const sectionId = this._idResolver(href)\n          if (hash) {\n            return `#${sectionId},${hash}`\n          }\n          return `#${sectionId}`\n        }\n        return href\n      },\n      resolveSrc: (src) => {\n        if (isInternalUri(src)) {\n          // todo: may have bugs\n          const absolutePath = path.resolve('/', src).substr(1)\n          const buffer = this._resourceResolver(absolutePath).asNodeBuffer()\n          const base64 = buffer.toString('base64')\n          return `data:image/png;base64,${base64}`\n        }\n        return src\n      }\n    })\n  }\n}\n\nconst parseSection = (config: ParseSectionConfig) => {\n  return new Section(config)\n}\n\nexport default parseSection\n\n\n\n// WEBPACK FOOTER //\n// /Users/liang/Projects/@gxl/epub-parser/src/parseSection.ts","import _ from 'lodash'\n\nconst debug = require('debug')('readr:parsers:utils')\n\nexport function flattenArray(arrayOfNestedObj, childrenName = 'children') {\n  const list = []\n\n  const push = infoList => {\n    infoList.forEach(item => {\n      list.push(_.omit(item, childrenName))\n      if (item[childrenName]) {\n        push(item[childrenName])\n      }\n    })\n  }\n\n  push(arrayOfNestedObj)\n  return list\n}\n\nexport interface ParseNestedObjectConfig {\n  preFilter?: (node) => boolean\n  postFilter?: (node) => boolean\n\n  // children must be returned from parser\n  // or it may not work as expected\n  parser?: (node, children) => any\n  finalParser?: (node) => any\n\n  childrenKey: string\n}\n\n/**\n * parseNestedObject\n * a note about config.parser\n * 'children' is recursively parsed object and should be returned for parser to take effect\n * objects without [childrenKey] will be parsed by finalParser\n * @param _rootObject \n * @param config \n */\nconst parseNestedObjectWrapper = (_rootObject: Object | Object[], config: ParseNestedObjectConfig) => {\n  const { childrenKey, parser, preFilter, postFilter, finalParser } = config\n\n  if (!_rootObject) {\n    return []\n  }\n\n  const parseNestedObject = (rootObject: Object | Object[]): any[] => {\n    const makeArray = () => {\n      if (Array.isArray(rootObject) || _.isArrayLikeObject(rootObject) || _.isArrayLike(rootObject)) {\n        return rootObject\n      }\n      return [rootObject]\n    }\n    const rootArray = makeArray()\n\n    return Array.prototype\n      .filter.call(rootArray, object => {\n        if (preFilter) {\n          return preFilter(object)\n        }\n        return true\n      })\n      .map((object, index) => {\n        if (object[childrenKey]) {\n          const children = parseNestedObject(object[childrenKey])\n          if (parser) {\n            return parser(object, children)\n          }\n          return {\n            ...object,\n            ...{\n              [childrenKey]: children\n            }\n          }\n        }\n\n        if (finalParser) {\n          return finalParser(object)\n        }\n        return object\n      })\n      .filter(object => {\n        if (postFilter) {\n          return postFilter(object)\n        }\n        return true\n      })\n  }\n\n  return parseNestedObject(_rootObject)\n}\n\nexport const parseNestedObject = parseNestedObjectWrapper\n\n\n\n// WEBPACK FOOTER //\n// /Users/liang/Projects/@gxl/epub-parser/src/utils.ts","module.exports = require(\"babel-runtime/core-js/promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/promise\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/defineProperty\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/defineProperty\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/typeof\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/typeof\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"babel-runtime/regenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/regenerator\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"crypt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypt\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"is-buffer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"is-buffer\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"jsdom\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsdom\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"lodash/find\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/find\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"lodash/flattenDeep\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/flattenDeep\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"lodash/forEach\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/forEach\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"lodash/get\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/get\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"lodash/isArrayLike\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isArrayLike\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"lodash/isArrayLikeObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isArrayLikeObject\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"lodash/isEmpty\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isEmpty\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"lodash/last\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/last\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"lodash/map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/map\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"lodash/omit\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/omit\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"lodash/union\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/union\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"node-zip\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-zip\"\n// module id = 31\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 32\n// module chunks = 0","module.exports = require(\"xml2js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"xml2js\"\n// module id = 33\n// module chunks = 0"],"sourceRoot":""}